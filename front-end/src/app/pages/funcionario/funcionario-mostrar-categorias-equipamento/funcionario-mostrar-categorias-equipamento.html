<app-loading-overlay [visible]="loading"></app-loading-overlay>
<main class="bg-gray-50 dark:bg-gray-950 min-h-screen p-4 sm:p-6 lg:p-8">
  <div class="max-w-7xl mx-auto">

    <div class="mb-10">
      <h1 class="text-4xl font-bold text-gray-800 dark:text-white">
        Gerenciar Categorias
      </h1>
      <p class="mt-2 text-lg text-gray-600 dark:text-gray-400">
        Adicione, edite ou remova categorias de equipamento.
      </p>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-12">
      <div class="lg:col-span-1">
        <div class="bg-white dark:bg-gray-900 rounded-lg shadow-md p-6 mb-8">
          <h2 class="text-xl font-bold mb-4 text-gray-800 dark:text-white">Adicionar Nova Categoria</h2>
          <form #addForm="ngForm" (ngSubmit)="onAdicionar(addForm);$event.preventDefault()" class="flex flex-col gap-4">
            <input
              type="text"
              name="nomeCategoria"
              placeholder="Nome da Categoria"
              required
              [(ngModel)]="novaCategoria.descricao"
              class="p-3 border dark:border-gray-600 rounded-lg bg-gray-50 dark:bg-gray-700 dark:text-white placeholder:text-gray-400"
            />
            <button
              type="submit"
              [disabled]="addForm.invalid"
              class="py-3 px-6 bg-blue-600 dark:bg-blue-700 text-white font-semibold rounded-lg shadow-md hover:bg-blue-700 dark:hover:bg-blue-800"
            >
              Adicionar
            </button>
          </form>
        </div>
      </div>
      <div class="lg:col-span-2">
        <div class="bg-white dark:bg-gray-900 rounded-lg shadow-md overflow-hidden">
          <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
            <thead class="bg-gray-100 dark:bg-gray-800">
              <tr>
                <th class="px-6 py-3 text-left text-xs font-semibold text-gray-600 dark:text-gray-400 uppercase tracking-wider">ID</th>
                <th class="px-6 py-3 text-left text-xs font-semibold text-gray-600 dark:text-gray-400 uppercase tracking-wider">Nome da Categoria</th>
                <th class="px-6 py-3 text-left text-xs font-semibold text-gray-600 dark:text-gray-400 uppercase tracking-wider">Ações</th>
              </tr>
            </thead>
            @if (loading) {
              <tbody class="bg-white dark:bg-gray-900 divide-y divide-gray-200 dark:divide-gray-700">
                @for (_ of [1, 2, 3, 4, 5]; track $index) {
                  <tr class="animate-pulse">
                    <td class="px-6 py-4 whitespace-nowrap">
                      <div class="h-4 bg-gray-300 dark:bg-gray-700 rounded w-1/4"></div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                      <div class="h-4 bg-gray-300 dark:bg-gray-700 rounded w-3/4"></div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                      <div class="flex gap-4">
                        <div class="h-6 w-16 bg-gray-300 dark:bg-gray-700 rounded-md"></div>
                        <div class="h-6 w-16 bg-gray-300 dark:bg-gray-700 rounded-md"></div>
                      </div>
                    </td>
                  </tr>
                }
              </tbody>
            } @else {
            <tbody class="bg-white dark:bg-gray-900 divide-y divide-gray-200 dark:divide-gray-700">
              @for (categoria of categorias; track categoria.id) {
                <tr class="hover:bg-gray-50 dark:hover:bg-gray-800">
                  <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-gray-200">{{ categoria.id }}</td>
                  <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-gray-200">{{ categoria.descricao }}</td>
                  <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                    <a href="#" (click)="onEditar(categoria.id); $event.preventDefault()" class="text-blue-600 hover:text-blue-900 dark:text-blue-400 dark:hover:text-blue-300 mr-4">Editar</a>
                    <a href="#" (click)="onRemover(categoria.id); $event.preventDefault()" class="text-red-600 hover:text-red-900 dark:text-red-400 dark:hover:text-red-300">Remover</a>
                  </td>
                </tr>
              }
              @if(!categorias){
                <tr>
                  <td colspan="3" class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-gray-200 text-center">Nenhuma categoria cadastrada.</td>
                </tr>
              }
            </tbody>
          }
          </table>
        </div>
      </div>
    </div>
  </div>

  @if(categoriaEmEdicao.id != 0){
    <div class="fixed inset-0 bg-black bg-opacity-50 dark:bg-opacity-70 flex justify-center items-center z-50 transition-opacity" aria-labelledby="modal-title" role="dialog" aria-modal="true">
      <div class="bg-white dark:bg-gray-800 rounded-xl shadow-2xl p-8 my-8 w-full max-w-lg transform transition-all">
        <h2 class="text-xl font-bold mb-4 text-gray-800 dark:text-white">Editando categoria: {{categoriaEmEdicao.descricaoOriginal}}</h2>
        <form #editForm="ngForm" (ngSubmit)="onSalvarEdicao()" class="flex flex-col gap-4">
          <input
            type="text"
            name="nomeEdicao"
            placeholder="Nome"
            required
            [(ngModel)]="categoriaEmEdicao.descricao"
            class="p-3 border dark:border-gray-600 rounded-lg bg-gray-50 dark:bg-gray-700 dark:text-white placeholder:text-gray-400">
          <div class="flex gap-4">
            <button type="submit"
              [disabled]="editForm.invalid"
              class="flex-1 py-3 px-6 bg-blue-600 dark:bg-blue-700 text-white font-semibold rounded-lg shadow-md hover:bg-blue-700 dark:hover:bg-blue-800">
              Salvar alterações
            </button>
            <button
              type="button"
              (click)="categoriaEmEdicao.id = 0"
              class="flex-1 py-3 px-6 bg-stone-600 dark:bg-stone-700 text-white font-semibold rounded-lg shadow-md hover:bg-stone-700 dark:hover:bg-stone-800">
              Cancelar
            </button>
          </div>
        </form>
      </div>
    </div>
  }

  @if (showRemoverModal) {
    <app-remover-categoria (onConfirm)="confirmarRemocao()" (onCancel)="cancelarRemocao()"></app-remover-categoria>
  }
</main>
